'use strict';

var fluent = require('fluent');

function o(e,r,n){if(!e.validate)throw new Error("validate is not defined in context");let t=e.validate.get("errors",r,[]);e.validate.set("errors",r,t),e.validate.set("valid",r,t.length===0);let i=e.validate.get("value",r);if(typeof i!="string")return e.validate.set("valid",r,!1),t.includes("invalid string")||(t.push("invalid string"),e.validate.set("errors",r,t)),r;let l=n({value:i});return l.valid||(e.validate.set("valid",r,!1),t.push(l.error),e.validate.set("errors",r,t)),r}var y={coerce(e){try{this.validate.set("value",e,e.value.toString());}catch{}return o(this,e,()=>({valid:!0,error:null}))},default(e,r){let n=this.validate.get("value",e,null);return n==null&&this.validate.set("value",e,r),o(this,e,()=>({valid:!0,error:null}))},required(e,r=""){return o(this,e,({value:n})=>{let t=!!(n&&n.length>0);return {valid:t,error:t?null:r||"string is required"}})},enum(e,r,n=""){return o(this,e,({value:t})=>{let i=r.includes(t);return {valid:i,error:i?null:n||"invalid value"}})},min(e,r,n=""){return o(this,e,({value:t})=>{let i=!!(t&&t.length>=r);return {valid:i,error:i?null:n||`too short - min length ${r}`}})},max(e,r,n=""){return o(this,e,({value:t})=>{let i=!!(t&&t.length<=r);return {valid:i,error:i?null:n||`too long - max length ${r}`}})},length(e,r,n=""){return o(this,e,({value:t})=>{let i=!!(t&&t.length===r);return {valid:i,error:i?null:n||`invalid length - length ${r}`}})},match(e,r,n=""){return o(this,e,({value:t})=>{let i=new RegExp(r).test(t);return {valid:i,error:i?null:n||"invalid pattern"}})}};function s(e,r,n){if(!e.validate)throw new Error("validate is not defined in context");let t=e.validate.get("errors",r,[]);e.validate.set("errors",r,t),e.validate.set("valid",r,t.length===0);let i=e.validate.get("value",r);if(typeof i!="number")return e.validate.set("valid",r,!1),t.includes("invalid number")||(t.push("invalid number"),e.validate.set("errors",r,t)),r;let l=n({value:i});return l.valid||(e.validate.set("valid",r,!1),t.push(l.error),e.validate.set("errors",r,t)),r}var p={coerce(e){try{let r=this.validate.get("value",e,0);this.validate.set("value",e,Number(r));}catch{}return s(this,e,()=>({valid:!0,error:null}))},default(e,r){let n=this.validate.get("value",e,null);return n==null&&this.validate.set("value",e,r),s(this,e,()=>({valid:!0,error:null}))},required(e,r=""){return s(this,e,({value:n})=>{let t=n!=null;return {valid:t,error:t?null:r||"number is required"}})},enum(e,r,n=""){return s(this,e,({value:t})=>{let i=r.includes(t);return {valid:i,error:i?null:n||"invalid value"}})},min(e,r,n=""){return s(this,e,({value:t})=>{let i=t>=r;return {valid:i,error:i?null:n||`too small - min value ${r}`}})},max(e,r,n=""){return s(this,e,({value:t})=>{let i=t<=r;return {valid:i,error:i?null:n||`too large - max value ${r}`}})},integer(e,r=""){return s(this,e,({value:n})=>{let t=Number.isInteger(n);return {valid:t,error:t?null:r||"invalid integer"}})}};function u(e,r,n){if(!e.validate)throw new Error("validate is not defined in context");let t=e.validate.get("errors",r,[]);e.validate.set("errors",r,t),e.validate.set("valid",r,t.length===0);let i=e.validate.get("value",r);if(!Array.isArray(i))return e.validate.set("valid",r,!1),t.includes("invalid array")||(t.push("invalid array"),e.validate.set("errors",r,t)),r;let l=n({value:i});return l.valid||(e.validate.set("valid",r,!1),t.push(l.error),e.validate.set("errors",r,t)),r}var x={coerce(e){try{this.validate.set("value",e,JSON.parse(e.value));}catch{}return u(this,e,()=>({valid:!0,error:null}))},default(e,r){let n=this.validate.get("value",e);return n==null&&this.validate.set("value",e,r),u(this,e,()=>({valid:!0,error:null}))},required(e,r=""){return u(this,e,({value:n})=>{let t=n&&n.length>0;return {valid:t,error:t?null:r||"array is required"}})},min(e,r,n=""){return u(this,e,({value:t})=>{let i=t&&t.length>=r;return {valid:i,error:i?null:n||`too short - min length ${r}`}})},max(e,r,n=""){return u(this,e,({value:t})=>{let i=t&&t.length<=r;return {valid:i,error:i?null:n||`too long - max length ${r}`}})},items(e,r,n=""){return u(this,e,({value:t})=>{let i=t&&t.every(l=>{let a={};return this.validate.set("value",a,l),r.run(a).valid});return {valid:i,error:i?null:n||`invalid items - expected ${r.chain[0].method.split(".")[0]}`}})}};function d(e,r,n){if(!e.validate)throw new Error("validate is not defined in context");let t=e.validate.get("errors",r,[]);e.validate.set("errors",r,t),e.validate.set("valid",r,t.length===0);let i=e.validate.get("value",r);if(typeof i!="object"||i===null)return e.validate.set("valid",r,!1),t.includes("invalid object")||(t.push("invalid object"),e.validate.set("errors",r,t)),r;let l=n({value:i});return l.valid||(e.validate.set("valid",r,!1),t.push(l.error),e.validate.set("errors",r,t)),r}var m={coerce(e){try{this.validate.set("value",e,JSON.parse(e.value));}catch{}return d(this,e,()=>({valid:!0,error:null}))},default(e,r){let n=this.validate.get("value",e,null);return n==null&&this.validate.set("value",e,r),d(this,e,()=>({valid:!0,error:null}))},required(e,r=""){return d(this,e,({value:n})=>{let t=n&&Object.keys(n).length>0;return {valid:t,error:t?null:r||"object is required"}})},props(e,r,n=""){return d(this,e,({value:t})=>{let i=Object.keys(r),l=!0,a=[];for(let v of i){let C=r[v],h={},j=this.validate.get("errors",h,[]);this.validate.set("value",h,t[v]);let g=C.run(h);if(!g.valid){l=!1;let w=this.validate.get("errors",g,[]);j.push(...w.map($=>`${v}: ${$}`)),a.push(v);}}return l?{valid:!0,error:null}:{valid:!1,error:n||a.length?`invalid props - ${a.join(", ")}`:""}})}};function c(e,r,n){if(!e.validate)throw new Error("validate is not defined in context");let t=e.validate.get("errors",r,[]);e.validate.set("errors",r,t),e.validate.set("valid",r,t.length===0);let i=e.validate.get("value",r);if(typeof i!="boolean")return e.validate.set("valid",r,!1),t.includes("invalid boolean")||(t.push("invalid boolean"),e.validate.set("errors",r,t)),r;let l=n({value:i});return l.valid||(e.validate.set("valid",r,!1),t.push(l.error),e.validate.set("errors",r,t)),r}var f={coerce(e){try{let r=this.validate.get("value",e,!1);this.validate.set("value",e,!!r);}catch{}return c(this,e,()=>({valid:!0,error:null}))},default(e,r){let n=this.validate.get("value",e,null);return n==null&&this.validate.set("value",e,r),c(this,e,()=>({valid:!0,error:null}))},required(e,r=""){return c(this,e,({value:n})=>{let t=n!=null;return {valid:t,error:t?null:r||"boolean is required"}})}};function q(e,r,n){return r[e]=r[e]||n,r[e]}function A(e,r,n){return r[e]=n,r}var b={validate:{set:A,get:q}};var k={string:y,number:p,array:x,object:m,boolean:f},L=fluent.fluent({api:k,ctx:b});

exports.api = k;
exports.ctx = b;
exports.validate = L;
//# sourceMappingURL=index.cjs.map
//# sourceMappingURL=index.cjs.map